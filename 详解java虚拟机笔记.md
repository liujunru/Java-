# 详解java虚拟机

### JVM与Java体系结构

#### JVM的整体结构

![image-20220424154414380](https://gitee.com/liujunrull/image-blob/raw/master/imageBlob/202204241544463.png)

##### java代码执行流程

![image-20220424155549423](https://gitee.com/liujunrull/image-blob/raw/master/imageBlob/202204241556196.png)

解释执行器：保证响应时间

JLT编译器针对热点代码再次解析执行，第一次编译将源文件编译成字节码文件，第二次编译是将字节码文件编译成机器指令，将热点代码缓存，JLT编译器负责程序的性能

#### JVM的架构模型

##### 基于栈式架构的特点

- 设计和实现更简单，适用于资源受限的系统，比如机顶盒
- 不开朗寄存器的分配难题：使用零地址指令方式分配
- 指令流中的指令大部分是零地址指令，其执行过程依赖于操作栈。指令集更小，编译器更容易实现
- 不需要硬件支持，可移植性更好，更好实现跨平台

##### 基于寄存器架构的特点

- 典型应用是X86的二进制指令集：比如传统的PC以及Android的Davlik虚拟机
- 指令集架构完全依赖硬件，可移植性差
- 性能优秀和执行更高效
- 花费更少的指令去完成一项操作
- 在大部分情况下，基于寄存器架构的指令集往往都以一地址指令、二地址指令和三地址指令为主，而基于栈式架构的指令集却是以零地址指令为主。



java指令是根据**栈**来设计的，优点是跨平台性、指令集小；缺点是指令多，执行性能比寄存器差



反编译指令：javap

查看正在运行的进行：jps

#### JVM的生命周期

##### 虚拟机的启动

通过引导类加载器（bootstrap class loader)创建一个初始类(initial class)来完成的，这个类是由虚拟机的具体实现来指定的。 

##### 虚拟机的执行

执行一个所谓的java程序的时候，真正执行的事一个叫做java虚拟机的进程。

##### 虚拟机的退出

除了程序正常运行或者出现错误导致的正常退出，还可以调用Runtime类或者System类的exit方法，或者Runtime类的halt方法。

### 类加载子系统

![image-20220424225317436](https://gitee.com/liujunrull/image-blob/raw/master/202204242253562.png)